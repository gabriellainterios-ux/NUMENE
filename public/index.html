<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>NUMENE GATEWAY</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      /* Простейшие стили для загрузчика шлюза, пока React не инициализировался */
      body { background: #050505; color: #FF6700; font-family: monospace; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
     .loader { border: 2px solid #FF6700; padding: 20px; text-align: center; }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loader">
        <p>SYSTEM INITIALIZATION...</p>
        <p>DECRYPTING ARTIFACT...</p>
      </div>
    </div>
    
    <script>
      // GATEWAY LOGIC [13, 14]
      (function() {
        // Проверяем, открыто ли приложение внутри Telegram
        const isTelegram = window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData.length > 0;
        
        if (!isTelegram) {
          // Если это ОБЫЧНЫЙ БРАУЗЕР (скан NFC или переход по ссылке)
          const urlParams = new URLSearchParams(window.location.search);
          const artifactId = urlParams.get('id') |

| 'generic_entry';
          
          // Определяем тип устройства
          const userAgent = navigator.userAgent |

| navigator.vendor |
| window.opera;
          const isMobile = /android|iPad|iPhone|iPod/i.test(userAgent);

          if (isMobile) {
            // Перенаправление в Telegram Mini App через диплинк
            // Формат: tg://resolve?domain=YOUR_BOT_NAME&startapp=PARAMETER
            // startapp передаст ID артефакта внутрь мини-аппа
            window.location.href = `tg://resolve?domain=NumeneBot&startapp=${artifactId}`;
            
            // Fallback: если Telegram не установлен, перенаправляем на сайт через 2 секунды
            setTimeout(() => {
                window.location.href = "https://numene.com/install-telegram";
            }, 2500);
          } else {
            // Десктопная версия: показываем полноценный сайт (или заглушку "Only Mobile")
            // Здесь React позже отрендерит десктопную версию
            console.log("Desktop detected. Staying on web version.");
          }
        } else {
          // Если это TELEGRAM: ничего не делаем, даем загрузиться React (bundle.js)
          console.log("Telegram Environment Detected.");
          window.Telegram.WebApp.expand(); // Расширяем на весь экран [15]
        }
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
